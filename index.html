<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parfect Golfr</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#16a34a"/>
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="192x192" href="assets/icon-192-light.png">
  <link rel="apple-touch-icon" sizes="512x512" href="assets/icon-512-light.png">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log("Service Worker enregistr√©."))
        .catch(err => console.log("SW erreur", err));
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <!-- HEADER -->
  <header class="flex flex-col items-center justify-center py-4 bg-gray-800 shadow-md">
    <img src="assets/logo-stylised.svg" alt="Parfect Golfr" class="header-image mb-2" style="max-width:70px">
    <h1 class="text-green-400 font-bold text-2xl">Parfect Golfr</h1>
    <p class="text-sm text-gray-400">Break-80 Edition</p>
  </header>

  <!-- NAVBAR -->
  <nav class="bg-gray-700">
    <div class="max-w-4xl mx-auto flex justify-between items-center px-4 py-2">
      <div class="md:hidden">
        <button id="menu-btn" class="text-white focus:outline-none">‚ò∞</button>
      </div>
      <ul id="menu" class="hidden md:flex space-x-4">
        <li><a href="#" onclick="showPage('home')" class="hover:text-green-400">Accueil</a></li>
        <li><a href="#" onclick="showPage('scorecard')" class="hover:text-green-400">Carte</a></li>
        <li><a href="#" onclick="showPage('training')" class="hover:text-green-400">S'entra√Æner</a></li>
        <li><a href="#" onclick="showPage('history')" class="hover:text-green-400">Historique</a></li>
        <li><a href="#" onclick="showPage('objectives')" class="hover:text-green-400">Objectifs</a></li>
      </ul>
    </div>
    <div id="menu-mobile" class="hidden flex-col bg-gray-800 text-center"></div>
  </nav>

  <!-- MAIN PAGES -->
  <main class="max-w-4xl mx-auto p-4">
    <!-- HOME -->
    <section id="home" class="page active">
      <h2 class="text-xl font-bold mb-2">Bienvenue</h2>
      <button onclick="startNewGame()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded">Nouvelle Partie</button>
      <button onclick="showPage('training')" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded ml-2">S'entra√Æner</button>
    </section>

    <!-- SCORECARD -->
    <section id="scorecard" class="page hidden">
      <h2 class="text-lg font-bold mb-2">Carte de score</h2>
      <div id="progress" class="mb-2 text-sm text-gray-400"></div>
      <form id="hole-form"></form>
      <div class="flex justify-between mt-4">
        <button onclick="prevHole()" class="bg-gray-600 px-3 py-1 rounded">Pr√©c√©dent</button>
        <button onclick="nextHole()" class="bg-green-600 px-3 py-1 rounded">Suivant</button>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="history" class="page hidden">
      <h2 class="text-lg font-bold mb-2">Historique</h2>
      <div id="history-list"></div>
    </section>

    <!-- OBJECTIVES -->
    <section id="objectives" class="page hidden">
      <h2 class="text-lg font-bold mb-2">Mes Objectifs</h2>
      <p class="text-gray-400">S√©lectionnez votre niveau de progression (Break-100 / 90 / 80)</p>
      <div id="objectives-content" class="mt-4"></div>
    </section>

    <!-- TRAINING -->
    <section id="training" class="page hidden">
      <h2 class="text-lg font-bold mb-2">Entra√Ænement</h2>
      <p class="text-gray-400">S√©lectionnez un exercice et enregistrez vos scores.</p>
      <div id="training-content" class="mt-4"></div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="bg-gray-800 text-gray-400 text-center py-3 mt-6">
    <p>&copy; 2025 Parfect.golfr ¬∑ <a href="https://instagram.com/parfect.golfr" target="_blank" class="hover:text-green-400">@parfect.golfr</a> ¬∑ v5.2</p>
  </footer>

  <script>
    // --- STATE ---
    let currentHole = 1;
    let totalHoles = 18;
    let gameData = [];

    // --- NAVIGATION ---
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(pageId).classList.remove('hidden');
      if (pageId === 'scorecard') renderHole();
      if (pageId === 'history') renderHistory();
      if (pageId === 'objectives') renderObjectives();
      if (pageId === 'training') renderTraining();
    }

    // --- NEW GAME ---
    function startNewGame() {
      currentHole = 1;
      gameData = [];
      totalHoles = confirm("Voulez-vous jouer 18 trous ? (Annuler = 9)") ? 18 : 9;
      showPage('scorecard');
    }

    // --- HOLE RENDER ---
    function renderHole() {
      renderProgress();
      const form = document.getElementById('hole-form');
      const holeData = gameData[currentHole-1] || {};
      const bgClass = (currentHole % 2 === 0) ? "bg-gray-700" : "bg-gray-800";
      form.innerHTML = `
        <div class="${bgClass} p-4 rounded-lg space-y-2">
          <h3 class="text-lg font-semibold mb-2 text-center">Trou ${currentHole}</h3>
          <div class="grid grid-cols-2 gap-3">
            <label class="flex items-center space-x-2">
              <span>R√©sultat :</span>
              <select id="result" class="text-black px-2 flex-1">
                <option value="-2" ${holeData.result===-2?'selected':''}>Eagle (-2)</option>
                <option value="-1" ${holeData.result===-1?'selected':''}>Birdie (-1)</option>
                <option value="0" ${holeData.result===0||holeData.result===undefined?'selected':''}>Par (0)</option>
                <option value="1" ${holeData.result===1?'selected':''}>Bogey (+1)</option>
                <option value="2" ${holeData.result===2?'selected':''}>Double Bogey (+2)</option>
                <option value="3" ${holeData.result===3?'selected':''}>Triple+ (+3)</option>
              </select>
            </label>
            <label class="flex items-center space-x-2">
              <span>Putts :</span>
              <select id="putts" class="text-black px-2 flex-1">
                ${[...Array(7).keys()].map(v => `<option value="${v}" ${holeData.putts===v?'selected':''}>${v}</option>`).join('')}
              </select>
            </label>
            <label class="flex items-center space-x-2 col-span-2">
              <span>Distance 1er putt (m):</span>
              <select id="puttDistance" class="text-black px-2 flex-1">
                ${Array.from({length:41}, (_,i)=>`<option value="${i}" ${holeData.puttDistance===i?'selected':''}>${i}</option>`).join('')}
              </select>
            </label>
            <label class="flex items-center"><input type="checkbox" id="fairway" ${holeData.fairway?'checked':''}> <span class="ml-2">Fairway touch√©</span></label>
            <label class="flex items-center"><input type="checkbox" id="gir" ${holeData.gir?'checked':''}> <span class="ml-2">Green en r√©gulation</span></label>
            <label class="flex items-center"><input type="checkbox" id="routine" ${holeData.routine?'checked':''}> <span class="ml-2">Routine respect√©e</span></label>
            <label class="flex items-center"><input type="checkbox" id="plan" ${holeData.plan?'checked':''}> <span class="ml-2">Plan de jeu respect√©</span></label>
          </div>
        </div>
      `;
      document.getElementById('result').addEventListener('change', onFieldChange);
      document.getElementById('putts').addEventListener('input', onFieldChange);
      document.getElementById('puttDistance').addEventListener('input', onFieldChange);
      ['fairway','gir','routine','plan'].forEach(id => document.getElementById(id).addEventListener('change', onFieldChange));
    }

    // --- UPDATE DATA ---
    function onFieldChange() {
      const hole = {
        result: parseInt(document.getElementById('result').value),
        putts: parseInt(document.getElementById('putts').value),
        puttDistance: parseInt(document.getElementById('puttDistance').value),
        fairway: document.getElementById('fairway').checked,
        gir: document.getElementById('gir').checked,
        routine: document.getElementById('routine').checked,
        plan: document.getElementById('plan').checked
      };
      gameData[currentHole-1] = hole;
    }

    // --- HOLE NAV ---
    function nextHole() {
      if (currentHole < totalHoles) {
        currentHole++;
        renderHole();
        toast(`‚û°Ô∏è Direction le trou ${currentHole}`);
      } else {
        toast(`üèÅ Direction le 19√®me trou !`);
        showPage('history');
      }
    }
    function prevHole() {
      if (currentHole > 1) {
        currentHole--;
        renderHole();
      }
    }

    // --- PROGRESS ---
    function renderProgress() {
      const total = gameData.reduce((a,h)=>a+(h?.result||0),0);
      document.getElementById('progress').innerText = `Score cumul√© : ${total >= 0 ? '+'+total : total}`;
    }

    // --- TOAST ---
    function toast(msg) {
      const el = document.createElement('div');
      el.className = "fixed top-1/3 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded shadow-lg text-center";
      el.innerHTML = msg;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),2500);
    }

    // --- HISTORY ---
    function renderHistory() {
      let html = "<ul class='space-y-1'>";
      let total = 0;
      gameData.forEach((h,i)=>{
        const r = h?.result||0;
        total += r;
        html += `<li>Trou ${i+1}: ${r >=0? '+'+r : r} (${h.putts||0} putts)</li>`;
      });
      html += "</ul>";
      html += `<p class="mt-2 font-bold">Total: ${total >=0? '+'+total : total}</p>`;
      document.getElementById('history-list').innerHTML = html;
    }

    // --- OBJECTIVES ---
    function renderObjectives() {
      document.getElementById('objectives-content').innerHTML = `
        <ul class="space-y-2">
          <li><strong>Break 100</strong>: 29% Fairways ¬∑ 11% GIR ¬∑ 36 putts</li>
          <li><strong>Break 90</strong>: 57% Fairways ¬∑ 44% GIR ¬∑ 32 putts</li>
          <li><strong>Break 80</strong>: 79% Fairways ¬∑ 67% GIR ¬∑ 29 putts</li>
        </ul>
      `;
    }

    // --- TRAINING ---
    function renderTraining() {
      document.getElementById('training-content').innerHTML = `
        <button onclick="toast('Exercice putting: 10 balles √† 2m')" class="bg-blue-500 px-3 py-1 rounded">Putting</button>
        <button onclick="toast('Exercice chipping: 5 approches au drapeau')" class="bg-yellow-500 px-3 py-1 rounded ml-2">Chipping</button>
        <button onclick="toast('Exercice driver: 10 balles sur fairway')" class="bg-red-500 px-3 py-1 rounded ml-2">Driver</button>
      `;
    }
  </script>
</body>
</html>
