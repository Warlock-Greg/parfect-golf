<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parfect.golfr — Zen & Mental 2026</title>

  <!-- Google Font (optionnel) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Ton CSS principal -->
  <link rel="stylesheet" href="css/style2026.css" />

  <!-- (Optionnel) Fav icon -->
  <link rel="icon" href="fav-icon.ico.png" />
</head>

<body class="zen-theme onboarding-active">

  <!-- =========================================
       COACH WHISPER (ZEN)
       - Discret, auto-hide
       - Swipe down (ou click) pour ouvrir l'historique
       ========================================= -->
  <div id="coach-whisper" class="pg-whisper whisper-hidden" aria-live="polite">
    <div class="pg-whisper-inner">
      <span class="pg-whisper-icon">Coach</span>
      <p id="whisper-text" class="pg-whisper-text">Respire, visualise ta cible...</p>
    </div>
  </div>

  <!-- Historique (ouvrable) -->
  <div id="coach-whisper-history" class="pg-whisper-history hidden">
    <div class="pg-whisper-history-card">
      <div class="pg-whisper-history-header">
        <div class="pg-whisper-history-title">Historique des conseils</div>
        <button id="whisper-history-close" class="pg-btn-secondary" type="button">Fermer</button>
      </div>
      <div id="whisper-history-list" class="pg-whisper-history-list"></div>
    </div>
  </div>

  <!-- =========================================
       HEADER (Zen)
       - Visible sur Home/Play/Training/Friends
       - Caché en mode JustSwing fullscreen
       ========================================= -->
  <header id="pg-header" class="pg-header">
    <img
      src="logo-parfect-golfr.png"
      alt="Logo Parfect.golfr"
      class="pg-header-logo"
    />
  </header>

  <!-- =========================================
       PARFECT COUNTER (reward doux)
       ========================================= -->
  <div id="parfect-counter" class="pg-parfect-counter">0 Parfect collecté</div>

  <!-- =========================================
       APP CONTAINER
       - Une seule vue visible à la fois
       ========================================= -->
  <main id="app-container" class="pg-app">

    <!-- ===== Viewport (tes vues) ===== -->
    <section id="view-port" class="pg-viewport">

      <!-- HOME (Hub) -->
      <section id="home-area" class="pg-home" style="display:none;">
        <div class="pg-home-header">
          <h1 class="pg-home-title">Que veux-tu faire maintenant ?</h1>
          <p class="pg-home-subtitle">
            On vise le fairway, puis le GIR, puis le 2 putts.
            Les Parfect récompensent tes bonnes décisions.
          </p>
        </div>

        <div class="pg-home-tiles">
          <button id="home-play" class="pg-tile" type="button">
            <div class="pg-tile-title">Parcours</div>
            <div class="pg-tile-desc">Score coup par coup, méthode Parfect</div>
          </button>

          <button id="home-just-swing" class="pg-tile" type="button">
            <div class="pg-tile-title">Just Swing</div>
            <div class="pg-tile-desc">Focus technique, session pleine écran</div>
          </button>

          <button id="home-training" class="pg-tile" type="button">
            <div class="pg-tile-title">Training</div>
            <div class="pg-tile-desc">Répétition, routine, mental</div>
          </button>

          <button id="home-friends" class="pg-tile" type="button">
            <div class="pg-tile-title">Club-house</div>
            <div class="pg-tile-desc">Social, historique, espace</div>
          </button>
        </div>
      </section>

      <!-- PLAY -->
      <section id="game-area" class="pg-view" style="display:none;">
        <!-- Placeholders indispensables pour play.js -->
        <div id="golf-select"></div>
        <div id="hole-card"></div>
      </section>

      <!-- TRAINING -->
      <section id="training-area" class="pg-view" style="display:none;"></section>

      <!-- FRIENDS -->
      <section id="friends-area" class="pg-view" style="display:none;"></section>

      <!-- HISTORY -->
      <section id="history-area" class="pg-view" style="display:none;"></section>

    </section>
  </main>

  <!-- =========================================
       JUST SWING (fullscreen focus)
       - header/nav cachés via body.jsw-fullscreen
       - bouton Quitter unique
       ========================================= -->
  <section id="just-swing-area" class="jsw-area" style="display:none;">
    <div id="just-swing-screen" class="jsw-screen">
      <video id="jsw-video" autoplay playsinline></video>
      <canvas id="jsw-overlay"></canvas>
      <div id="jsw-big-msg" class="jsw-big-msg"></div>

      <!-- Top minimal : logo discret + whisper déjà au-dessus (global) -->
      <div class="jsw-top-minimal">
        <img src="logo-parfect-golfr.png" alt="Parfect.golfr" class="jsw-logo" />
      </div>

      <!-- Bas : action unique -->
      <div class="jsw-bottom-action">
        <button id="jsw-exit-btn" class="pg-btn-primary" type="button">Quitter</button>
      </div>
    </div>

    <!-- Sélecteur club + routine (si tes scripts l’attendent) -->
    <div class="jsw-top-right" style="display:none;">
      <select id="jsw-club-select" class="jsw-select">
        <option value="fer7">Fer 7</option>
        <option value="fer8">Fer 8</option>
        <option value="fer9">Fer 9</option>
        <option value="pw">PW</option>
        <option value="sw">SW</option>
        <option value="driver">Driver</option>
        <option value="bois3">Bois 3</option>
      </select>

      <button id="jsw-open-routine-modal" class="pg-btn-secondary" type="button">
        Routine
      </button>
    </div>
  </section>

  <!-- =========================================
       SWING REVIEW (tu l’avais en overlay)
       - je conserve tes IDs
       ========================================= -->
  <section id="swing-review" style="display:none;">
    <div class="swing-review-video">
      <video id="swing-video" playsinline></video>

      <div class="swing-player-controls">
        <button id="swing-play-pause" type="button">Play</button>

        <select id="swing-speed">
          <option value="0.25">0.25×</option>
          <option value="0.5">0.5×</option>
          <option value="1" selected>1×</option>
          <option value="1.5">1.5×</option>
          <option value="2">2×</option>
        </select>

        <input id="swing-timeline" type="range" min="0" max="100" value="0">
        <span id="swing-time-label">0.0s</span>
      </div>
    </div>

    <div id="swing-score-breakdown" style="display:none;"></div>

    <div class="swing-review-info">
      <h2 id="swing-review-score" style="display:none;">Score : --</h2>
      <p id="swing-review-comment" style="display:none;">Analyse…</p>
    </div>

    <div class="swing-review-actions">
      <button id="swing-save-reference" class="pg-btn-secondary" type="button">
        Définir comme ma référence
      </button>

      <button id="swing-save-parfect-reference" class="pg-btn-secondary" type="button" style="display:none;">
        Définir comme référence PARFECT
      </button>

      <div id="parfect-ref-feedback" style="display:none;"></div>

      <button id="swing-review-next" class="pg-btn-primary" type="button">
        Swing suivant
      </button>
    </div>

    <div class="swing-review-history">
      <h3>Historique</h3>
      <div id="swing-history" class="swing-history-list"></div>
    </div>

    <button id="jsw-close-review" class="pg-btn-secondary" type="button">
      Fermer
    </button>
  </section>

  <!-- =========================================
       ONBOARDING (Zen)
       - garde tes principes, mention carte coup par coup + Parfect
       ========================================= -->
  <div id="onboarding" class="pg-onboarding">
    <img src="logo-parfect-golfr.png" alt="Parfect.golfr" class="pg-logo">

    <h2 class="pg-onboarding-title">Bienvenue sur Parfect.golfr</h2>

    <p class="pg-onboarding-subtitle">
      Une méthode de progression orientée décisions.
      Moins de pression, plus de régularité.
    </p>

    <div class="pg-onboarding-cards">
      <div class="pg-card">
        <h3>Carte de score coup par coup</h3>
        <p>
          Tu ne vises pas le par.
          Tu vises le fairway, puis le GIR, puis le 2 putts.
        </p>
        <p class="pg-highlight">
          Chaque bonne décision te rapporte un Parfect.
        </p>
      </div>

      <div class="pg-card">
        <h3>Just Swing</h3>
        <p>
          Une session focus technique en plein écran,
          avec un accompagnement simple et bienveillant.
        </p>
      </div>

      <div class="pg-card">
        <h3>Mental</h3>
        <p>
          Routine, clarté, intentions simples.
          L’IA soutient, elle ne juge pas.
        </p>
      </div>
    </div>

    <button id="start-onboarding" class="pg-btn-primary" type="button">
      Commencer
    </button>
  </div>

  <!-- =========================================
       NAV BOTTOM (Home hub)
       - Visible hors Just Swing fullscreen
       - On garde TES IDs pour router.js
       ========================================= -->
  <nav id="pg-nav" class="bottom-nav">
    <button id="home-btn" class="nav-btn" type="button">
      <img src="fav-icon.png" alt="Accueil">
      <span>Accueil</span>
    </button>

    <button id="just-swing-btn" class="nav-btn" type="button">
      <img src="parfect-justswing.png" alt="Just Swing">
      <span>Swing</span>
    </button>

    <button id="play-btn" class="nav-btn" type="button">
      <img src="parfect-play.png" alt="Parcours">
      <span>Parcours</span>
    </button>

    <button id="training-btn" class="nav-btn" type="button">
      <img src="parfect-train.png" alt="Training">
      <span>Training</span>
    </button>

    <button id="friends-btn" class="nav-btn" type="button">
      <img src="parfect-espace.png" alt="Club-house">
      <span>Club-house</span>
    </button>
  </nav>

  <!-- =========================================
       LEGACY COACH (compat JS)
       - On le garde pour éviter les crashs
       - Mais tu peux le masquer via CSS (Zen Whisper remplace l’UI)
       ========================================= -->
  <section id="coach-ia" class="pg-coach-legacy" style="display:none;">
    <div id="coach-log"></div>
    <div id="coach-input-zone">
      <input id="coach-input" type="text" placeholder="Pose ta question au coach…">
      <button id="coach-send" type="button">Envoyer</button>
    </div>
  </section>

  <!-- Helper global $ -->
  <script>
    if (!window.$) window.$ = (id) => document.getElementById(id);
  </script>

  <!-- =========================================
       COACH REACT -> Zen Whisper
       - remplace l’ancienne UX chat
       - auto-hide 4s
       - stocke un historique
       ========================================= -->
  <script>
    (function () {
      const whisper = document.getElementById("coach-whisper");
      const whisperText = document.getElementById("whisper-text");
      const historyWrap = document.getElementById("coach-whisper-history");
      const historyList = document.getElementById("whisper-history-list");
      const closeBtn = document.getElementById("whisper-history-close");

      let hideTimer = null;
      const history = [];

      function showWhisper(message) {
        if (!whisper || !whisperText) return;

        // message court (Zen)
        const clean = String(message || "").trim();
        if (!clean) return;

        whisperText.textContent = clean;

        whisper.classList.remove("whisper-hidden");
        whisper.classList.add("whisper-show");

        // historise
        history.unshift({ t: Date.now(), m: clean });
        if (history.length > 30) history.pop();
        renderHistory();

        if (hideTimer) clearTimeout(hideTimer);
        hideTimer = setTimeout(() => {
          whisper.classList.add("whisper-hidden");
          whisper.classList.remove("whisper-show");
        }, 4000);
      }

      function renderHistory() {
        if (!historyList) return;
        historyList.innerHTML = history
          .map((h) => `<div class="pg-whisper-item">${escapeHtml(h.m)}</div>`)
          .join("");
      }

      function escapeHtml(str) {
        return str.replace(/[&<>"']/g, (c) => ({
          "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#039;"
        }[c]));
      }

      // click sur la bulle => ouvre l'historique
      whisper?.addEventListener("click", () => {
        historyWrap?.classList.remove("hidden");
      });

      closeBtn?.addEventListener("click", () => {
        historyWrap?.classList.add("hidden");
      });

      // expose coachReact global pour router.js & autres
      window.coachReact = window.coachReact || function (msg) {
        // si appendCoachMessage existe, on le laisse vivre, mais on pousse aussi le whisper
        try {
          if (typeof appendCoachMessage === "function") appendCoachMessage(msg);
        } catch (_) {}
        showWhisper(msg);
      };

      // expose util pour debug
      window.__pgWhisper = { showWhisper };
    })();
  </script>

  <!-- =========================================
       ONBOARDING / NAV FLOW (une tâche, un esprit)
       ========================================= -->
  <script>
    function showView(viewId) {
      const ids = ["home-area", "game-area", "training-area", "friends-area", "history-area"];
      ids.forEach((id) => {
        const el = document.getElementById(id);
        if (el) el.style.display = (id === viewId) ? "block" : "none";
      });
    }

    function enterJustSwing() {
      document.body.classList.add("jsw-fullscreen");
      document.getElementById("just-swing-area").style.display = "block";
    }

    function exitJustSwing() {
      document.body.classList.remove("jsw-fullscreen");
      document.getElementById("just-swing-area").style.display = "none";
      // sécurité: stop sessions si dispo
      window.JustSwing?.stopSession?.();
      window.SwingEngine?.reset?.();
      // retour Home
      document.getElementById("home-btn")?.click();
    }

    document.getElementById("start-onboarding")?.addEventListener("click", () => {
      document.body.classList.remove("onboarding-active");
      document.getElementById("onboarding").style.display = "none";
      showView("home-area");
      window.coachReact?.("Choisis une action. Une seule intention, un seul coup.");
    });

    // Home tiles
    document.getElementById("home-play")?.addEventListener("click", () => document.getElementById("play-btn")?.click());
    document.getElementById("home-training")?.addEventListener("click", () => document.getElementById("training-btn")?.click());
    document.getElementById("home-just-swing")?.addEventListener("click", () => document.getElementById("just-swing-btn")?.click());
    document.getElementById("home-friends")?.addEventListener("click", () => document.getElementById("friends-btn")?.click());

    // Just Swing exit
    document.getElementById("jsw-exit-btn")?.addEventListener("click", exitJustSwing);

    // Default view safety
    if (document.body.classList.contains("onboarding-active")) {
      showView("home-area"); // sera masquée par onboarding, mais évite état vide après
    }
  </script>

  <!-- =========================================
       DEPENDENCIES & MODULES (TES SCRIPTS)
       - on garde ton ordre logique
       ========================================= -->

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="js/coachIA.js"></script>
  <script src="js/play.js"></script>
  <script src="js/training.js"></script>
  <script src="js/HistoryHub.js"></script>
  <script src="js/social.js"></script>

  <script src="js/config.js"></script>
  <script src="js/licence.js"></script>
  <script src="js/main.js"></script>

  <!-- MediaPipe -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

  <script src="js/mediapipe-init.js"></script>
  <script src="js/faceOnAnalyzer.js"></script>
  <script src="js/SwingEngine.js"></script>
  <script src="js/SwingScorer.js"></script>
  <script src="js/SwingCapture.js"></script>
  <script src="js/SwingPlayer.js"></script>
  <script src="js/SwingHistory.js"></script>

  <script src="js/justSwing.js"></script>
  <script src="js/jsw-clubs.js"></script>
  <script src="js/jsw-routine-modal.js"></script>
  <script src="js/jsw-swing-log.js"></script>
  <script src="js/jsw-replay.js"></script>

  <!-- Router (en dernier) -->
  <script src="js/router.js"></script>

</body>
</html>

